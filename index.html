<!DOCTYPE html>
<html>

<head>
	<meta charset="utf-8" />
	<link rel="shortcut icon"
		href="https://static-index-4gtuqm3bfa95c963-1304825656.tcloudbaseapp.com/official-website/favicon.svg"
		mce_href="https://static-index-4gtuqm3bfa95c963-1304825656.tcloudbaseapp.com/official-website/favicon.svg"
		type="image/x-icon" />
	<meta name="viewport"
		content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no" />
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet"
		integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous" />
	<title>信息填报</title>
	<style>
		body {
			font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", "Droid Sans", "Helvetica Neue", "PingFang SC", "Hiragino Sans GB", "Droid Sans Fallback", "Microsoft YaHei", sans-serif;
		}

		.title-logo {
			width: 80px;
			height: 80px;
		}

		.container {
			display: flex;
			flex-direction: column;
			align-items: center;
		}

		.container .form {
			width: 97%;
			margin: 20px auto 0;
			box-shadow: 0px 1px 10px 2px #eaeaea;
			border-radius: 5px;
		}

		.container .form .fItem {
			display: flex;
			justify-content: space-between;
			align-items: center;
			padding: 4% 3%;
			color: #555;
			border-bottom: 1px solid #eaeaea;
		}

		.container .form .fItem:nth-last-child(1) {
			border-bottom: none;
		}

		.container .form .fItem input {
			border: none;
			outline: none;
			text-align: right;
		}

		.container .handleSubmit {
			position: fixed;
			bottom: 0;
			width: 100%;
			background-color: #4694ff;
			color: #fff;
			text-align: center;
			padding: 6% 0;
		}

		.container .dialog {
			position: fixed;
			background: rgba(0, 0, 0, .5);
			width: 100%;
			height: 100%;
			top: 0;
		}

		.container .dialog .white {
			position: absolute;
			top: 40%;
			background: #fff;
			transform: translateY(-50%);
			width: 70%;
			left: 15%;
			border-radius: 10px;
			padding: 12% 0;
			text-align: center;
		}

		.container .dialog .dialogBtn {
			position: absolute;
			width: 100%;
			bottom: 0;
			border-top: 1px solid #eaeaea;
		}

		.container .dialog .dialogBtn span {
			display: block;
			height: 60px;
			line-height: 60px;
		}

		.container .dialog .dialogBtn2 {
			position: absolute;
			width: 100%;
			bottom: 0;
			display: flex;
			justify-content: space-between;
			align-items: center;
			border-top: 1px solid #eaeaea;
		}

		.container .dialog .dialogBtn2 span {
			display: inline-block;
			width: 50%;
			height: 60px;
			line-height: 60px;
		}

		.container .dialog .dialogBtn2 span:nth-child(1) {
			border-right: 1px solid #eaeaea;
		}

		.container .dialog .infoTxt {
			margin-bottom: 40px;
		}

		.count-button {
			width: 320px;
			height: 40px;
			box-sizing: border-box;
			margin: 16px 8px;
			font-weight: 500;
			font-size: 17px;
			color: #FFFFFF;
			letter-spacing: 1px;
			text-align: center;
			border-radius: 4px;
		}

		.count-number {
			align-self: flex-start;
			opacity: 0.9;
			font-weight: 500;
			font-size: 14px;
			color: #000000;
		}

		.count-reset {
			color: #576b95;
			cursor: pointer;
			margin-left: auto;
		}

		.count-text {
			width: 320px;
			height: 40px;
			padding: 0 12px;
			margin: 0 auto;
			line-height: 40px;
			text-align: left;
			display: flex;
			border: 1px solid rgba(0, 0, 0, 0.1);
			border-radius: 4px;
			opacity: 0.9;
			box-sizing: border-box;
			font-weight: 400;
			font-size: 14px;
			color: #000000;
		}

		.quote {
			font-size: 12px;
		}

		.qrcode {
			height: 144px;
			width: 144px;
			display: block;
			margin: 0 auto;
		}

		.title {
			display: flex;
			align-items: center;
			justify-content: center;
			flex-direction: column;
			width: 320px;
		}

		.title-text {
			width: 320px;
			height: 48px;
			text-align: center;
			margin-top: 16px;
			font-size: 32px;
			opacity: 0.9;
			font-weight: 500;
			font-size: 32px;
			color: #000000;
			letter-spacing: 0;
			line-height: 48px;
		}

		.counter-container {
			margin-top: 48px;
		}

		.hr {
			text-align: center;
			position: relative;
			z-index: 2;
			height: 20px;
			line-height: 20px;
		}

		.hr::after {
			position: absolute;
			content: '';
			top: 10px;
			left: 60px;
			width: 200px;
			border-bottom: 1px solid rgba(0, 0, 0, .1);
			z-index: -1;
		}

		.hr small {
			display: inline-block;
			background-color: white;
		}

		.hr-text {
			display: inline-block;
			height: 20px;
			font-weight: 400;
			font-size: 14px;
			color: rgba(0, 0, 0, 0.55);
			letter-spacing: 0;
			text-align: center;
			z-index: 2;
			background-color: white;
			padding: 0 8px;
			line-height: 20px;
		}

		.link-button {
			width: 154px;
			height: 48px;
			box-sizing: border-box;
			font-weight: 400;
			font-size: 14px;
			color: rgba(0, 0, 0, 0.90);
			letter-spacing: 0;
			text-align: center;
			background: rgba(0, 0, 0, 0.03);
			border-radius: 6px;
			display: flex;
			align-items: center;
			justify-content: center;
		}

		.card {
			margin-top: 16px;
			width: 320px;
			height: 200px;
			box-sizing: border-box;
			border: 1px solid rgba(0, 0, 0, 0.10);
			border-radius: 5.71px;
			position: relative;
		}

		.card-text {
			text-align: center;
			font-weight: 400;
			font-size: 14px;
			color: rgba(0, 0, 0, 0.55);
			letter-spacing: 0;
		}
	</style>
	<script src="https://unpkg.com/vconsole@latest/dist/vconsole.min.js"></script>
	<script src="https://res.wx.qq.com/open/js/jweixin-1.6.0.js"></script>
	<script src="https://web-9gikcbug35bad3a8-1304825656.tcloudbaseapp.com/sdk/1.3.0/cloud.js"></script>
	<script src="https://web-9gikcbug35bad3a8-1304825656.tcloudbaseapp.com/sdk/1.3.1/mplogin.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/vue/2.6.11/vue.js"></script>
</head>

<body>
	<div class="container" id="index">
		<div class="form">
			<div class="fItem">
				<span>车牌号</span>
				<input type="text" placeholder="请输入车牌号" v-bind:value="formInfo.carNo" v-on:input="formInfo.carNo = $event.target.value">
			</div>
			<div class="fItem">
				<span>车辆吨位</span>
				<input type="text" placeholder="请输入车辆吨位" v-bind:value="formInfo.dunwei" :key="needUpdate" v-on:input="formInfo.dunwei = $event.target.value">
			</div>
			<div class="fItem">
				<span>危化品品名/种类</span>
				<input type="text" placeholder="请输入危化品品名/种类"  v-bind:value="formInfo.weihuapin" v-on:input="formInfo.weihuapin = $event.target.value">
			</div>
			<div class="fItem">
				<span>联系人</span>
				<input type="text" placeholder="请输入联系人" v-bind:value="formInfo.name" v-on:input="formInfo.name = $event.target.value">
			</div>
			<div class="fItem">
				<span>联系方式</span>
				<input type="text" placeholder="请输入联系方式" v-bind:value="formInfo.moble" v-on:input="formInfo.moble = $event.target.value">
			</div>
			<div class="fItem">
				<span>车辆状况</span>
				<input type="text" placeholder="请输入车辆状况" v-bind:value="formInfo.zhuangkuang" v-on:input="formInfo.zhuangkuang = $event.target.value">
			</div>
		</div>
		<div class="handleSubmit" @click="handleSubmit">提交</div>
		<div class="dialog" v-if="dialogVis">
			<div class="white">
				<p class="infoTxt">{{tipText}}</p>
				<div class="dialogBtn">
					<span @click="dialogVis=false">确认</span>
				</div>
			</div>
		</div>
	</div>
</body>
<script src="https://mat1.gtimg.com/www/asset/lib/jquery/jquery/jquery-1.11.1.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"
	integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous">
	</script>
<script>
	new Vue({
		el: "#index",
		data() {
			return {
				tipText: '请填写完整数据',
				dialogVis: false,
				CurRecordID: 0,//用户当前的车辆记录ID
				CurUserInfo: {}, //当前用户信息
				phoneReg: /^1[3|4|5|7|8][0-9]\d{8}$/,
				needUpdate: 1,
				formInfo: {
					carNo: '1',
					dunwei: '2',
					weihuapin: '3',
					name: '4',
					moble: '5',
					zhuangkuang: '6',
				},
			};
		},
		async created() {
			let myappid = "wxa806018a131603d3";
			const vConsole = new window.VConsole();
			const result = await window.mplogin({
				scope: "snsapi_userinfo", // 必填，登录方式：snsapi_userinfo、snsapi_base
				appid: myappid, // 必填，公众号appid，将以此 appid 名义进行请求
				// redirect: '',                      // 选填，授权成功后路由的地址，目标地址应能处理授权参数，不填为当前页面
				envid: 'prod-4g9w3eru303c9c3a', // 选填，资源方微信云托管环境，如果传递此参数则会返回初始化的 cloud 操作对象
				resourceAppid: myappid, // 选填，如果是资源复用模式，需要填资源方微信账号
				signature: window.location.href // 选填，如果需要微信 SDK 的API方法，则填写要使用的地址，会返回 signature 签名对象，envid参数不填则无效
			})
			try {
				if (result.ret === 0) {
					window.app = result.cloud
					const callres = await window.app.callContainer({
						path: '/api/GetUserInfo',
						method: 'POST',
						header: {
							'X-WX-SERVICE': 'golang-zqzy',
							'X-WX-CLOUDID': result.info
						},
						config: {
							'env': 'prod-4g9w3eru303c9c3a'
						},
						contentType: "application/json; charset=utf-8",
						dataType: "json",
						data: JSON.stringify({
							"openid": result.info
						})
					})
					this.CurUserInfo = JSON.parse(callres["data"]["data_list"][0]["json"])["data"]
					console.log(this.CurUserInfo)
				} else { // ret不为0时，代表登录出现错误，一般出现在开发调试中，正式使用一般只有2-系统拦截错误
					// 登录出现问题，打印问题描述
					//window.alert(result.msg)
				}
			} catch (e) {
				console.log(e)
			}
			//获取该用户的最近的停车记录
			this.getOne();
		},
		methods: {
			async handleSubmit() {
				console.log(this.formInfo);
				for (let i in this.formInfo) {
					if (!this.formInfo[i]) {
						this.tipText = '请填写完整数据';
						this.dialogVis = true;//错误提示
						return false
					}
				}
				if (!this.phoneReg.test(this.formInfo.moble)) {
					this.tipText = '请输入正确的手机号';
					this.dialogVis = true;//错误提示
					return false
				}
				console.log(JSON.stringify({
					"wechartid": CurUserInfo["openId"],
					"carNo": this.formInfo.carNo,
					"dunwei": this.formInfo.dunwei,
					"weihuapin": this.formInfo.weihuapin,
					"name": this.formInfo.name,
					"moble": this.formInfo.moble,
					"zhuangkuang": this.formInfo.zhuangkuang,
				}));
				await window.app.callContainer({
					path: '/api/CarInsert',
					method: 'POST',
					header: {
						'X-WX-SERVICE': 'golang-zqzy',
					},
					config: {
						'env': 'prod-4g9w3eru303c9c3a'
					},
					contentType: "application/json; charset=utf-8",
					dataType: "json",
					data: JSON.stringify({
						"wechartid": CurUserInfo["openId"],
						"carNo": this.formInfo.carNo,
						"dunwei": this.formInfo.dunwei,
						"weihuapin": this.formInfo.weihuapin,
						"name": this.formInfo.name,
						"moble": this.formInfo.moble,
						"zhuangkuang": this.formInfo.zhuangkuang,
					}),
					success: function (res) {
						console.log(JSON.stringify(res))
						this.tipText = "提交成功";
						this.dialogVis = true;//提示
					},
					fail: function (res) {
						console.log(JSON.stringify(res))
					}
				})
			},
			async getOne() {
				var that=this;
				await window.app.callContainer({
					path: '/api/CarGet',
					method: 'POST',
					header: {
						'X-WX-SERVICE': 'golang-zqzy',
					},
					config: {
						'env': 'prod-4g9w3eru303c9c3a'
					},
					contentType: "application/json; charset=utf-8",
					dataType: "json",
					data: JSON.stringify({
						"wechartid": this.CurUserInfo["openId"],
					}),
					success: function (res) {
						console.log(res);
						if (res.data.data.CarNo) {
							that.formInfo = {
								carNo: res.data.data.CarNo,
								dunwei: res.data.data.dunwei,
								weihuapin: res.data.data.weihuapin,
								name: res.data.data.name,
								moble: res.data.data.moble,
								zhuangkuang: res.data.data.zhuangkuang,
							};
							this.needUpdate = new Date().getTime(); //更新
							console.log(55);
							that.$set(this.formInfo, "dunwei", res.data.data.dunwei)
						}
						this.formInfo = Object.assign({}, this.formInfo)
						console.log(this.needUpdate);
						console.log(this.formInfo);
					},
					fail: function (res) {
						alert(JSON.stringify(res))
					}
				})

			},
		}
	})
</script>
<!-- <script>
	async function set() {
		await window.app.callContainer({
			path: '/api/CarInsert',
			method: 'POST',
			header: {
				'X-WX-SERVICE': 'golang-zqzy',
			},
			config: {
				'env': 'prod-4g9w3eru303c9c3a'
			},
			contentType: "application/json; charset=utf-8",
			dataType: "json",
			data: JSON.stringify({
				"wechartid": CurUserInfo["openId"],
				"carNo": "fff000f",
				"dunwei": 30.0,
				"weihuapin": "硫酸;",
				"name": "张云雷",
				"moble": "18888888888",
				"zhuangkuang": "良好01"
			}),
			success: function (res) {
				alert(JSON.stringify(res))
			},
			fail: function (res) {
				alert(JSON.stringify(res))
			}
		})
	}
	async function out() {
		if (CurRecordID <= 0) {
			alert("请先获取ID,或者入场")
		} else {
			await window.app.callContainer({
				path: '/api/CarOver',
				method: 'POST',
				header: {
					'X-WX-SERVICE': 'golang-zqzy',
				},
				config: {
					'env': 'prod-4g9w3eru303c9c3a'
				},
				contentType: "application/json; charset=utf-8",
				dataType: "json",
				data: JSON.stringify({
					"id": CurRecordID
				}),
				success: function (res) {
					alert("hello,world")
					CurRecordID = 0
				},
				fail: function (res) {
					alert(JSON.stringify(res))
				}
			})
		}


	}
	async function getOne() {
		await window.app.callContainer({
			path: '/api/CarGet',
			method: 'POST',
			header: {
				'X-WX-SERVICE': 'golang-zqzy',
			},
			config: {
				'env': 'prod-4g9w3eru303c9c3a'
			},
			contentType: "application/json; charset=utf-8",
			dataType: "json",
			data: JSON.stringify({
				"wechartid": CurUserInfo["openId"],
			}),
			success: function (res) {
				console.log(res);
				if (res.data.data) {
					this.formInfo = res.data.data;
				}
			},
			fail: function (res) {
				alert(JSON.stringify(res))
			}
		})

	}
	async function get() {
		if (CurUserInfo["nickName"] === "唐文光") {
			await window.app.callContainer({
				path: '/api/CarList',
				method: 'POST',
				header: {
					'X-WX-SERVICE': 'golang-zqzy',
				},
				config: {
					'env': 'prod-4g9w3eru303c9c3a'
				},
				contentType: "application/json; charset=utf-8",
				dataType: "json",
				data: JSON.stringify({
					"status": 2,
				}),
				success: function (res) {
					alert(JSON.stringify(res))
				},
				fail: function (res) {
					alert(JSON.stringify(res))
				}
			})
		}


	}
</script> -->

</html>
